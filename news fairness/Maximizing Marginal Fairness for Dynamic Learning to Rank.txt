Maximizing Marginal Fairness for Dynamic Learning to Rank
Tao Yang

Qingyao Ai

University of Utah
Salt Lake City, Utah
taoyang@cs.utah.edu

University of Utah
Salt Lake City, Utah
aiqy@cs.utah.edu

arXiv:2102.09670v1 [cs.IR] 18 Feb 2021

ABSTRACT
Rankings, especially those in search and recommendation systems,
often determine how people access information and how information is exposed to people. Therefore, how to balance the relevance
and fairness of information exposure is considered as one of the key
problems for modern IR systems. As conventional ranking frameworks that myopically sorts documents with their relevance will
inevitably introduce unfair result exposure, recent studies on ranking fairness mostly focus on dynamic ranking paradigms where
result rankings can be adapted in real-time to support fairness in
groups (i.e., races, genders, etc.). Existing studies on fairness in dynamic learning to rank, however, often achieve the overall fairness
of document exposure in ranked lists by significantly sacrificing
the performance of result relevance and fairness on the top results.
To address this problem, we propose a fair and unbiased ranking
method named Maximal Marginal Fairness (MMF). The algorithm
integrates unbiased estimators for both relevance and merit-based
fairness while providing an explicit controller that balances the
selection of documents to maximize the marginal relevance and
fairness in top-k results. Theoretical and empirical analysis shows
that, with small compromises on long list fairness, our method
achieves superior efficiency and effectiveness comparing to the
state-of-the-art algorithms in both relevance and fairness for top-k
rankings.

CCS CONCEPTS
â€¢ Information systems â†’ Learning to rank.

KEYWORDS
Learning to Rank, Ranking Fairness, Unbiased Learning
ACM Reference Format:
Tao Yang and Qingyao Ai. 2021. Maximizing Marginal Fairness for Dynamic
Learning to Rank. In Proceedings of the Web Conference 2021 (WWW â€™21),
April 19â€“23, 2021, Ljubljana, Slovenia. ACM, New York, NY, USA, 10 pages.
https://doi.org/10.1145/3442381.3449901

1

INTRODUCTION

Fairness in ranking has drawn much attention as ranking systems,
especially those in search and recommendation systems, could
significantly affect how people access information and how information is exposed to users [5]. For example, job posts ranked highly
This paper is published under the Creative Commons Attribution 4.0 International
(CC-BY 4.0) license. Authors reserve their rights to disseminate the work on their
personal and corporate Web sites with the appropriate attribution.
WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia
Â© 2021 IW3C2 (International World Wide Web Conference Committee), published
under Creative Commons CC-BY 4.0 License.
ACM ISBN 978-1-4503-8312-7/21/04.
https://doi.org/10.1145/3442381.3449901

on LinkedIn are more likely to receive more applications; new products on the bottom of Amazon search result pages are less likely
to be clicked by customers. Without proper treatments, ranking
systems could introduce unintended unfairness to various aspects
of peopleâ€™s lives, such as job opportunities, economical gain, etc.
As traditional ranking algorithms that produce static ranked lists
can hardly handle the unfairness of result exposure in practice, the
ranking paradigms that dynamically change result ranking on the
fly, namely the dynamic Learning-to-Rank (LTR) [20], have received
more and more attention in the research communities. The idea
of dynamic LTR is to learn and adapt ranking models based on
user feedback in real time so that past user interactions or result
distributions could affect the exposure of future results. Through
heavily exposed to implicit user examination bias [14, 16, 33] and
selection bias [21, 28], dynamic LTR allows ranking systems to
produce multiple ranked lists for a single request, which makes it
possible to explicitly control or balance the exposure of results in
different groups (i.e., race, gender, etc.) for ranking fairness.
Existing studies on ranking fairness in dynamic LTR mostly focuses on developing effective algorithms to achieve merit-based
fairness [5, 25]. Well-known examples include the linear programming algorithm (LinProg) [25] that determines result ranking by
taking group fairness as an optimization constraint, and the FairCo
algorithm [20] that manipulates ranking scores dynamically according to the current exposure of results in different groups. Despite
their solid theoretical foundations, these algorithms often sacrifice
the performance of result relevance significantly on the top results
of each ranked list. These trade-offs are uncontrollable as they are
difficult to be quantified explicitly, which makes the risk of applying
fairness algorithms in practice still high today.
In this paper, we present a novel fairness algorithm for dynamic
LTR that considers both relevance and fairness for ranking criterion. We believe that it is important to control and balance result
relevance and fairness in online ranking systems, especially for the
top-k results in ranked lists. Therefore, inspired by the studies of
search diversification that try to improve novelty while preserving
ranking performance (especially the maximal marginal relevance
frameworks [6]), we propose a Maximal Marginal Fairness (MMF)
algorithm that optimizes ranking performance while explicitly mitigating amortized group unfairness for selected items. MMF dynamically selects documents that are relevant and underexposed
in top-k results to maximize the marginal relevance and fairness.
With a small compromise on the bottom of long ranked lists, MMF
achieves superior performance and significantly outperforms the
state-of-the-art fairness algorithms not only in top-k relevance, but
also in top-k fairness. As most people would examine or only examine the top results on a result page [8, 13, 19, 27], MMF is highly
competitive and preferable in real LTR systems and applications.

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

Tao Yang and Qingyao Ai

Table 1: A summary of notations.
From technical viewpoints, the main contribution of this paper
are two-fold. First, extending the existing definition of merit-based
group fairness in ranking [5, 25], we develop a metric to measure
the group fairness of exposure in the top-k rankings. We show that
most existing state-of-the-art methods for ranking fairness focus
more on the overall fairness of document exposure while compromising a lot in the top ranks of each ranked list. Second, we propose
a Maximal Marginal Fairness (MMF) algorithm that can explicitly
control and balance result relevance and fairness in top-k rankings.
In particular, our method uses a hyper-parameter ğœ† to determine
whether the system needs to select an item being relevant or an
item that improves the marginal fairness of the current ranked list.
We evaluate and compare our algorithm with existing state-of-theart methods on both synthetic and real-world preference datasets
using simulated user interactions. Theoretical and empirical analysis shows that our method can achieve significant efficiency and
effectiveness improvements in top-k relevance and fairness.

2

RELATED WORK

Leveraging biased click data for optimizing learning to rank systems
has been a popular approach in information retrieval [13, 14]. As
click data are often noisy and biased, numerous unbiased learning
to rank (ULTR) methods have been proposed based on different
theoretical foundations [4], including click models [9, 12, 29], randomization [22], causal inference [1, 3, 17], etc. Those methods
make it possible to achieve unbiased relevance estimation or rankings for learning to rank in noisy environments.
Ranking according to intrinsic result relevance is important yet
not enough today. One of the key principle [23] of ranking in
Information Retrieval states that documents should be ranked in
order of the probability of relevance or usefulness. Such arguments,
however, only consider the responsibilities of ranking systems to
users while ignoring the items being ranked. Recently, there has
been a growing concern about fairness behind ranking algorithms
in both academia and industry [5, 34, 35]. Since rankings are the
main interface from which we find content, products, music, news
and etc., their ordering contributes not only to the utility of users,
but also to information providers.
To address this, some studies focus on restricting the fraction of
items of each attribute in a ranking [32, 34]. While another natural
way of understanding unfairness is by considering difference in
exposure, which directly relates unfairness to economic or social
opportunities [35]. For example, researchers try to achieve amortized fairness of exposure by reducing group disparate exposure
for only the top position [35] or making exposure proportional to
relevance [5, 20, 25, 26]. The reason for reducing exposure disparity
is that minimal difference in relevance can result in a large difference in exposure across groups [25] if the ranking only is based on
relevance, since there might exist a large skew in the distribution of
exposure like position bias [15], i.e., users observe way much more
top ranks than the bottom part. To achieve this, various methods
have been proposed. For example, fairness loss based on Softmax
function is proposed by Zehlike and Castillo [35], which considers
equal group exposure in top rank. Linear programming methods
are proposed in [5, 7, 25], which try to give a general framework for
computing optimal probabilistic rankings for merit-based fairness.

ğˆğ’• ,ğ’™ ğ’• ,ğ’„ ğ’• ,
ğ’ğ’• , ğ’‘ğ’• , ğ’“ğ’•

ğ‘… (ğ‘‘)
ğ‘…ğœƒ (ğ‘‘ |ğ’™ ğ’• )
G,ğºğ‘– ,Gğ‘˜ğ‘–

The presented document ranking (ğˆğ’• ), the corresponding
feature vectors (ğ’™ ğ’• ), the clicks on each document (ğ’„ ğ’• ), the
binary variables indicating userâ€™s examination on each
document (ğ’ ğ’• ), userâ€™s propensity to examine results on
certain positions (ğ’‘ ğ’• , namely ğ‘ƒ (ğ’ ğ’• = 1)), and the true
(personalized) binary relevance rating of the documents
(ğ’“ ğ’• ) at time step ğ‘¡ in dynamic LTR setting.
The average relevance across all users for document ğ‘‘.
The predicted relevance of ğ‘‘ given by the model parameterized by ğœƒ .
The set of groups to consider (G) and the ğ‘–ğ‘¡â„ group (ğºğ‘– ).
Gğ‘˜ğ‘– is the priority queue of size k for ğºğ‘– according to
estimated relevance.

The policy learning method is adopted to maximize ranking metrics
while introducing unfairness as additional loss in [26].
In fact, the ideas behind existing fairness methods are always to
avoid showing items from the same class or group, which is not a
new topic and have already been studied as diversity and novelty
in the information Retrieval Community for decades [11, 30, 31].
Though the utility of diversified ranking is still centered on users
not for providers, studies on search diversification also focus on
optimizing result ranking beyond information relevance. One of
the most famous approaches is the maximal marginal relevance
approach (MMR) [6] that treats ranking as a Markov Decision
Process by selecting documents that maximize the combination of
sub-topic relevance given previously selected results.
In a recent work [20], the proportional controller in control
theory is applied to mitigate unfairness in dynamic LTR settings.
However, existing fairness algorithms in dynamic LTR only consider overall fairness while ignoring the top-k unfairness. In this
paper, we first define the top-k group fairness, which is often ignored by existing works. Then, based on the top-k fairness metrics,
inspired by MMR, we propose a concept named marginal fairness
and directly optimize top-k relevance and fairness in a dynamic
LTR environment where both the relevance and fairness modules
of the algorithms are learned and adapted according to real-time
user feedback.
Another algorithm is related with our work is FA*IR, proposed by
Zehlike et al. [34]. FA*IR is a post-processing method to explicitly
guarantees the exposure of documents in top-k ranking. The key
difference between our algorithm MMF and FA*IR is that FA*IR
focuses on a simplified offline scenario and ignore the fact that
result exposure could affect relevance estimations in LTR.

3

PROBLEM FORMULATION

In this section, we introduce the problem of relevance and fairness
estimation in dynamic LTR with a focus on the top-k results. A
summary of the notations used in this paper is shown in Table 1.

3.1

Relevance Estimation in Dynamic LTR

In dynamic LTR frameworks, the most popular paradigm for relevance estimation is to infer relevance from user feedback directly.
Specifically, from partial and biased feedback such as user clicks,
we need to construct a model to estimate relevance. In general,
traditional LTR models can be categorized as cardinal and ordinal ones. Ordinal LTR models give ordinal numbers according to
output scores for items, while those scores themselves have no
exact meaning. Cardinal LTR models, on the other hand, predict
document ranking scores that are proportional or directly reflect

Maximizing Marginal Fairness for Dynamic Learning to Rank

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

the relevance of the documents. Since exposure disparity explicitly
involves relevance, similar to previous studies [20], we only focus
on cardinal LTR models in this paper. Here, we adopt a LTR model
ğ‘…ğœƒ (ğ‘‘ |ğ’™ ğ’• ) parameterized by ğœƒ with least-square loss as
2
ğœ âˆ‘ï¸ 
âˆ‘ï¸
Lğœ (ğœƒ ) =
ğ’“ ğ’• (ğ‘‘) âˆ’ ğ‘…ğœƒ (ğ‘‘ |ğ’™ ğ’• )
Î”

=

ğ‘¡ =1 ğ‘‘
ğœ âˆ‘ï¸ 
âˆ‘ï¸

ğ‘…ğœƒ (ğ‘‘ |ğ’™ ğ’• ) 2 âˆ’ 2ğ’“ ğ’• (ğ‘‘)ğ‘…ğœƒ (ğ‘‘ |ğ’™ ğ’• )



(1)

ğ‘¡ =1 ğ‘‘

where ğœ is the total number of existing time steps in dynamic LTR,
Î”

and = means equal while ignoring constants.
As the true relevance judgements ğ’“ ğ’• are not available, based on
the studies of unbiased learning to rank [17], we define an unbiased estimation of Lğœ (ğœƒ ) using click data ğ’„ ğ’• by applying Inverse
Propensity Score (IPS) weighting as
eğœ (ğœƒ ) =
L

ğœ âˆ‘ï¸
âˆ‘ï¸

(ğ‘…ğœƒ (ğ‘‘ |xt ) 2 âˆ’ 2

ğ‘¡ =1 ğ‘‘

ct (d)
ğ‘… (ğ‘‘ |xt ))
ğ’‘ ğ’• (ğ‘‘) ğœƒ

top-k positions, then we can define group-based fairness in top-k
positions following the merit-based fairness definition [20] as
âˆ‘ï¸
1
ğ‘ğ‘¡ (ğ‘‘)
(6)
ğ¸ğ‘¥ğ‘ğ‘¡ğ‘˜ (ğºğ‘– ) =
|ğºğ‘– |
ğ‘˜
ğ‘‘ âˆˆğºğ‘– âˆ©ğ‘‘ âˆˆğˆğ’•

where ğˆğ’•ğ‘˜ is the top k documents in presented ranking ğˆğ’• , ğ’‘ ğ’• (ğ‘‘) is
the examination propensity on ğ‘‘ at time step ğ‘¡. Following previous
studies, we define the merit of a group or document as the expected
average relevance across all documents in the same group:
1 âˆ‘ï¸
ğ‘€ğ‘’ğ‘Ÿğ‘–ğ‘¡ (ğºğ‘– ) =
ğ‘…(ğ‘‘)
(7)
|ğºğ‘– |
ğ‘‘ âˆˆğºğ‘–

Thus, for any two groups ğºğ‘– and ğº ğ‘— , we can define their accumulative disparity in top-k positions as
ğ¸ğ‘¥ğ‘_ğ‘ğ‘¢ğ‘šğœğ‘˜ (ğºğ‘– ) =

(2)
ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ) =

where ğ’‘ ğ’• is the userâ€™s examination propensities on each result
position (namely ğ‘ƒ (ğ’ ğ’• = 1)), and we assume that
ğ‘ƒ (ğ‘ = 1) = ğ‘ƒ (ğ‘œ = 1) Â· ğ‘ƒ (ğ‘Ÿ = 1)

(3)

which means that users click a search result (ğ‘ = 1) only when it is
both observed (ğ‘œ = 1) and perceived as relevant (ğ‘Ÿ = 1), and ğ‘œ and ğ‘Ÿ
eğœ (ğœƒ ) can be proven as below
are independent. The unbiasness of L
eğœ (ğœƒ )] =
Eot [ L

ğœ âˆ‘ï¸
âˆ‘ï¸
ğ‘¡ =1 ğ‘‘

=

ğœ âˆ‘ï¸
âˆ‘ï¸
ğ‘¡ =1 ğ‘‘

=

ğœ âˆ‘ï¸
âˆ‘ï¸

ğ’‘ ğ’• (ğ‘‘)rt (d)
ğ‘…ğœƒ (ğ‘‘ |xt ))
ğ’‘ ğ’• (ğ‘‘)

ğ‘¡ =1 ğ‘‘

Similarly, we could get unbiased estimation of the average relevance
of ğ‘‘ across all users (ğ‘…(ğ‘‘)) as
ğœ

1 âˆ‘ï¸ ğ‘ğ‘¡ (ğ‘‘)
ğœ ğ‘¡ =1 ğ‘ğ‘¡ (ğ‘‘)

(5)

ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) is used for both fairness controlling and as a global ranking baseline without personalization (i.e., considering document
relevance with respect to each individual user). The estimation of
position bias ğ‘ğ‘¡ (ğ‘‘) can be achieved through various methods in
advance [2, 3, 29], which is not in the scope of this paper.

3.2

(8)

ğ‘€ğ‘’ğ‘Ÿğ‘–ğ‘¡ (ğºğ‘– )

Thus, larger disparity indicates greater violation of fairness in topk rankings. Additional to pairwise disparity defined in Eq.8, for
ranking with more than 2 groups, we define the unfairness of a list
as the average disparity of all pairs:
ğ‘š âˆ‘ï¸
ğ‘š
âˆ‘ï¸
2
ğ· ğ‘˜ (ğºğ‘– , ğº ğ‘— )
ğ‘š(ğ‘š âˆ’ 1) ğ‘–=0 ğ‘—=ğ‘–+1 ğœ

(9)

Note that the original merit-based unfairness defined in [20] can be
seen as a special case in our formulation where ğ‘˜ is the number of
all possible documents. In this paper, our goal is to create rankings
with high relevance ğ’“ğ‰ while maintaining a low unfairness ğ·ğœğ‘˜ in
top-k results after the time step ğœ in dynamic LTR.

(ğ‘…ğœƒ (ğ‘‘ |xt ) 2 âˆ’ 2rt (d)ğ‘…ğœƒ (ğ‘‘ |xt )) = Lğœ (ğœƒ )

ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) =

ğ‘¡ =1
1
ğ‘˜
ğœ ğ¸ğ‘¥ğ‘_ğ‘ğ‘¢ğ‘šğœ (ğºğ‘– )

Unfairness@k = ğ·ğœğ‘˜ =

(4)

ğ¸ğ‘¥ğ‘ğ‘¡ğ‘˜ (ğºğ‘– )

ğ·ğœğ‘˜ (ğºğ‘– , ğº ğ‘— ) = ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ) âˆ’ ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğº ğ‘— )

Eo [ct (d)]
(ğ‘…ğœƒ (ğ‘‘ |xt ) 2 âˆ’ 2 t
ğ‘…ğœƒ (ğ‘‘ |xt ))
ğ’‘ ğ’• (ğ‘‘)
(ğ‘…ğœƒ (ğ‘‘ |xt ) 2 âˆ’ 2

ğœ
âˆ‘ï¸

Merit-based Top-k Fairness

We now introduce the definition of the Top-k merit-based group
unfairness in dynamic LTR. First, similar to previous studies [5,
20, 25], we define the exposure of a document ğ‘‘ as its marginal
probability of being examined ğ’‘ ğ’• (ğ‘‘) = ğ‘ƒ (ğ’ ğ’• (ğ‘‘) = 1|ğˆğ’• , ğ’™ ğ’• , ğ’“ ğ’• )
where ğˆğ’• , ğ’™ ğ’• , ğ’“ ğ’• are the presented ranking, feature vectors, and
true relevance of documents at time step ğ‘¡ in dynamic LTR. Let
G = {ğº 1, ..., ğºğ‘š } be the possible groups that each document could
belong to. Suppose that we only care about the exposure fairness in

4

OUR APPROACH

In this section, we describe our approach to balance relevance and
fairness in dynamic LTR. Specifically, we first introduce the concept
of maximal marginal fairness, then we discuss our MMF algorithm.

4.1

Maximal Marginal Fairness

In this paper, we define a new concept for ranking fairness as Marginal Fairness. Ranking can be modeled as a greedy selection process
where we create a ranked list by sequentially selecting documents
from a candidate pool. Based on this assumption, considerable ranking algorithms have been proposed to optimize ranking utility from
various perspectives such as information relevance [18], novelty
[24], etc. Particularly, in the studies of search diversification, one
of the most well-known algorithms is the Maximal Marginal Relevance (MMR) algorithm [6] that greedily selects documents based
on their Marginal Relevance, the maximal utility of a document
given the selected results in the current ranked list, to balance ranking relevance and novelty. Inspired by MMR and the concept of
marginal relevance, we model ranking as a greedy selection problem and define marginal fairness as the marginal gain of fairness, or

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

Tao Yang and Qingyao Ai

the marginal reduction of unfairness, when selecting and adding a
document given the selected results in the current ranked list.
ğ‘‘ğœğ‘˜ is the document we select for ğ‘˜ ğ‘¡â„ position in the ranked list
ğˆğ‰ . Formally, then the marginal fairness of selecting document ğ‘‘ğœğ‘˜
from group ğº is
ğ‘€ğ¹ (ğº |ğœğœğ‘˜âˆ’1 ) = ğ·ğœğ‘˜âˆ’1 âˆ’ ğ·ğœğ‘˜ (ğ‘‘ğœğ‘˜ ), where ğ‘‘ğœğ‘˜ âˆˆ ğº

(10)

where ğ·ğœğ‘˜ (ğ‘‘ğœğ‘˜ ) is the unfairness after we select ğ‘‘ğœğ‘˜ .
Then, to maximize merit-based fairness of top ğ‘˜ results, a straightforward method is to maximize marginal fairness by selecting the
document with maximum ğ‘€ğ¹ (ğº |ğœğœğ‘˜âˆ’1 ). This observation serves as
our foundation for the construction of the MMF algorithm.

4.2

Algorithm

The MMF algorithm includes three sub-modules â€“ the selection of
documents for maximizing marginal fairness, the selection of documents for maximizing relevance, and the controller that balances
top-k relevance and fairness.
4.2.1 Fairness Module. As discussed previously, MMF optimizes
top-k fairness through greedily selecting documents to maximize
marginal fairness. In Eq. (10), the computation of marginal fairness requires us to compute the current and updated disparities
(ğ·ğœğ‘˜âˆ’1 (ğºğ‘– , ğº ğ‘— ) and ğ·ğœğ‘˜ (ğºğ‘– , ğº ğ‘— )) for every pair of groups. In practice, however, we can prove that maximal marginal fairness can
be achieved directly by selecting a document from the group with
lowest expected merit ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ) in Eq. (8) given that the scale
of ğ’‘ğ‰ (ğ‘‘) is much smaller than ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ) 1 . Also, as the true
relevance of documents ğ‘…(ğ‘‘) is not available, we use ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) to
estimate ğ‘…(ğ‘‘) and get an unbiased estimation of ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ) as
Ë†
ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğºğ‘– ).
Thus, we compute the best group to select documents from MMF
as
Ë†
ğºğœğ‘˜ = ğ‘šğ‘ğ‘¥ ğ‘€ğ¹ (ğº |ğœğœğ‘˜âˆ’1 ) = ğ‘šğ‘–ğ‘› ğ¸ğ‘¥ğ‘_ğ‘€ğ‘’ğ‘Ÿğœğ‘˜ (ğº)
(11)
ğº

ğº

Note that every document in ğºğœğ‘˜ would have the maximal marginal
fairness given the ranked list ğœğœğ‘˜âˆ’1 .
4.2.2 Relevance Module. To maximize the performance of top-k
results in terms of ranking relevance, the optimal solution is to
select documents based on their estimated relevance from user
interactions (i.e., ğ‘… ğ¼ ğ‘ƒğ‘† ) or a LTR model parameterized by ğœƒ (ğ‘…ğœƒ ) as
Â¯
ğ‘‘ğœğ‘˜ = ğ‘ğ‘Ÿğ‘”ğ‘šğ‘ğ‘¥ ğ‘…ğœƒ (ğ‘‘)
ğ‘‘âˆ‰ğœğœğ‘˜âˆ’1

(12)

where we only consider relevance but not fairness in selecting
the next document for the ranked list. In case we need to select
documents from the group with maximal marginal fairness, we
could apply similar process and get
Ëœ
ğ‘‘ğœğ‘˜ =

ğ‘ğ‘Ÿğ‘”ğ‘šğ‘ğ‘¥
ğ‘‘ âˆˆğºğœğ‘˜ âˆ§ğ‘‘âˆ‰ğœğœğ‘˜âˆ’1

ğ‘…ğœƒ (ğ‘‘)

(13)

In practice, Eq. (12) and Eq. (13) can be computed together by
maintaining multiple priority queues G, for each group separately.
1 We ignore the proof for simplicity

4.2.3 Balance between Relevance and Fairness. MMF implements a
simple yet effective method to control the relevance and fairness of
top-k rankings in dynamic LTR by adding a stochastic controller
parameterized with ğœ†. Intuitively, the idea of the controller is to
choose the final selected item ğ‘‘ğœğ‘˜ between the document that maxiÂ¯
mizes ranking relevance ğ‘‘ğœğ‘˜ and the document maximizing marginal
Ëœ
fairness ğ‘‘ğœğ‘˜ with probability ğœ†. Formally, we have
Ëœ
Â¯
ğ‘‘ğœğ‘˜ âˆ¼ (ğœ†ğ‘‘ğœğ‘˜ + (1 âˆ’ ğœ†)ğ‘‘ğœğ‘˜ )

(14)

The greater ğœ† is, the fairer the ranking is and the less ranking
relevance is. Different from the linear trade-off strategy used in
other fairness algorithms [20, 25] that directly combines the fairness
and relevance scores before the document selection process, we
adopt a probabilistic strategy to strike the balance, which not only
makes the algorithm more robust to the magnitude of estimated
relevance and fairness scores, but also provides explicit functions
to balance relevance and fairness in practical applications.
The overall MMF is shown in Algorithm 1. At step 1, we do
initialization. At step 2, a user enters the dynamic LTR system. At
step 3 âˆ’ 7, we dynamically learn a LTR model ğ‘…ğœƒ or directly use
the averaged inverse propensity weighted clicks ğ‘… ğ¼ ğ‘ƒğ‘† to estimate
the relevance of items. The LTR model has advantages over ğ‘… ğ¼ ğ‘ƒğ‘†
as it can estimate personalized relevance if features contain user
information. At step 8 âˆ’ 10, we construct priority queues for each
group with estimated relevance from step 3 âˆ’ 7. In practice, we
could construct priority queues while estimating relevance at the
time. At step 12 âˆ’ 21, we select the item according to Equations (12)
to (14). At step 15, ğºğ‘–ğ‘›ğ‘‘ is a function to get group index of an item.
At step 22, we collect clicks in a real-world application or sample
clicks according to Eq.3 for our experiments. At step 23 âˆ’ 27, we
update the relevance estimation accordingly. Note that, for different
time steps, users interact with the same item candidates at step
2 âˆ’ 27.

4.3

Complexity Analysis

To illustrate the efficiency of MMF, we conduct complexity analysis
and use the state-of-the-art fairness algorithm, i.e., FairCo [20].
FairCo is one of the most efficient fairness algorithms for dynamic
LTR. It achieves fairness by dynamically adding perturbations to
the ranking scores of documents based on the exposure of different
groups. As relevance is estimated separately, we only discuss the
complexity of fairness controlling in FairCo and MMF.
4.3.1 Time Complexity. Let ğ‘˜ be the number of ranks we care
about, |G| be the number of groups, and ğ‘› be the total number
of documents to rank. As FairCo needs to add score perturbations to all documents, it need to track the cumulative group exposure of all documents (i.e., ğ¸ğ‘¥ğ‘_ğ‘ğ‘¢ğ‘šğœğ‘› (ğºğ‘– ) in Eq. (8)) and do
linear interpolation with ğ‘‚ (ğ‘›) time. It needs ğ‘‚ (ğ‘˜ Â· ğ‘™ğ‘œğ‘”(ğ‘›)) to select top-k results from ğ‘› documents and thus has the overall time
complexity as ğ‘‚ (ğ‘˜ Â· ğ‘™ğ‘œğ‘”(ğ‘›) + ğ‘›). In contrast, MMF only tracks
ğ¸ğ‘¥ğ‘_ğ‘ğ‘¢ğ‘šğœğ‘˜ (ğºğ‘– ) for top-k results with ğ‘‚ (|G| Â· ğ‘˜) time. Besides, it
takes ğ‘‚ (|G| Â· ğ‘˜ Â· ğ‘™ğ‘œğ‘”(ğ‘›)) time to construct priority queue for each
group, and takes ğ‘‚ (|G| Ã— ğ‘˜) time to implement
 Eq.11. The overall
complexity of MMF is ğ‘‚ (ğ‘˜ Â· |G| Â· 1 + ğ‘™ğ‘œğ‘”(ğ‘›) ). Therefore, MMF
takes ğ‘‚ ((ğ‘› âˆ’ |G| Â· ğ‘˜) + ğ‘˜ Â· ğ‘™ğ‘œğ‘”(ğ‘›) Â· (1 âˆ’ |G|)) less time than FairCo.
Because the size of all documents is usually much more than the

Maximizing Marginal Fairness for Dynamic Learning to Rank

5.1

Algorithm 1: MMF
â†
âˆ’ 0, initialize ğ‘…ğœƒ , ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) â†
âˆ’ 0;

initialize ğœ† within [0,1], ğ‘˜, ct
for each user (time step ğœ) do
3
if Use_LTR_model then
4
Estimate relevance for all items with model ğ‘…ğœƒ ;
5
else
6
Estimate relevance for all items with ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘)
according to Eq.5;
7
end
8
for each group ğºğ‘– do
9
construct priority queues Gğ‘– of size k for group ğºğ‘–
with estimated relevance.
10
end
11
ranking=[];
12
for each rank i do
13
if random>ğœ† then
14
ğ‘‘ğ‘– selected with Eq.12, and ranking.append(ğ‘‘ğ‘– );
15
ğ‘— = ğºğ‘–ğ‘›ğ‘‘ (ğ‘‘ğ‘– ), index group id and assigin to j;
16
G ğ‘— .ğ‘ğ‘œğ‘ ()
17
else
18
select ğºğœğ‘˜ according to Eq.11 and assign ğºğœğ‘˜ to j;
19
ranking.append(G ğ‘— .ğ‘ğ‘œğ‘ ());
20
end
21
end
22
present ranking and collect user clicks cğœ , or sampling
clicks according to Eq.3;
23
if Use_LTR_model then
eğœ (ğœƒ ) loss in Eq.4. ;
24
train L
25
else
26
update ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) according to Eq.5;
27
end
28 end
1
2

number of ranks and the number of groups we care (i.e., ğ‘› >> ğ‘˜
and ğ‘› >> |G|) in most ranking applications, MMF outperforms
FairCo in time.
4.3.2 Space Complexity. MMF needs to track of ğ¸ğ‘¥ğ‘_ğ‘ğ‘¢ğ‘šğœğ‘˜ (ğºğ‘– )
in Eq. (8) for all positions in top-k rankings for the computation
of marginal fairness, which has space complexity as ğ‘‚ (|G| Â· ğ‘˜).
FairCo only needs to track the overall cumulative exposure of all
documents, which has space complexity as ğ‘‚ (ğ‘›). As the number of
groups (e.g., race, gender) and the ranks we care are usually small,
MMF outperforms FairCo in space.

5

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

EXPERIMENTS AND RESULTS

To evaluate our method, we conduct experiments on one dataset
with simulated preference data (i.e., the News dataset [10]) and
one dataset with real-world preference data (i.e., the Movie dataset
[10]). All the experimental scripts and model implementations used
on this paper is available online2 .
2 https://github.com/Taosheng-ty/Dynamic-Fairness.git

Simulated Preference Data

In this paper, we create a simulated preference dataset with the
news articles in the AdFrontes Media Bias dataset3 , which we refer
to as the News dataset. In this News dataset, each article contains a
polarity value ğœŒ ğ‘‘ that has been rescaled to the range between -1 and
1 (i.e., left-leaning and right-leaning). Following the methodology
used by Morik et al. [20], we simulate a dynamic LTR problem
on the News Dataset with simulated users and assign each user
with a polarity preference drawn from a mixture of two guassian
distirubtion and are also cliped to [âˆ’1, 1].
ğœŒğ‘¢ğ‘¡ âˆ¼ ğ‘ğ‘™ğ‘–ğ‘ [âˆ’1,1] (ğ‘ğ‘›ğ‘’ğ‘” N (âˆ’0.5, 0.2) + (1 âˆ’ ğ‘ğ‘›ğ‘’ğ‘” )N (0.5, 0.2)) (15)
where ğ‘ğ‘›ğ‘’ğ‘” is the probability of the user to be left-leaning. In addition, we simulate each user with an opensness parameter ğ‘œğ‘¢ğ‘¡ âˆ¼
U (0.05, 0.55), indicating on the breadth of interest outside their
polarity. With sampled ğ‘¢ğ‘¡ , ğœŒğ‘¢ğ‘¡ , and articlesâ€™ polarity value annotation ğœŒ ğ‘‘ , we could synthesize a true binary relevance judgement
following a Bernoulli distribution as



âˆ’(ğœŒğ‘¢ğ‘¡ âˆ’ ğœŒ ğ‘‘ ) 2
ğ’“ ğ’• (ğ‘‘) âˆ¼ ğµğ‘’ğ‘Ÿğ‘›ğ‘œğ‘¢ğ‘™ğ‘™ğ‘– ğ‘ = ğ‘’ğ‘¥ğ‘
(16)
2(ğ‘œğ‘¢ğ‘¡ ) 2
In each experiment trial, we sample a set of 30 news articles ğ·
to recommend to users. To investigate ranking fairness, we group
articles according to their polarity by assigning articles with ğœŒ ğ‘‘ âˆˆ
[âˆ’1, 0) to group ğº 1 and articles with ğœŒ ğ‘‘ âˆˆ [0, 1] to group ğº 2 .
We implement four baselines for comparison. The first one is
the Naive method that ranks documents by the sum of their observed user clicks (i.e., ğ’„ ğ’• ). The second one is a simple unbiased LTR
algorithm DULTR(Glob) that ranks documents by the unbiased
relevance estimation ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) in Eq. (5). To show the effectiveness
of MMF as a fairness algorithm, we also include two state-of-the-art
fairness algorithms for dynamic LTR, which are LinProg [25] and
FairCo [20]. Proposed by Singh and Joachims [25], LinProg considers group fairness as optimization constraints and implement a linear programming algorithm to maximize ranking fairness based on
the relevance estimated by ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘). In theory, LinProg would produce the best ranked lists in terms of merit-based fairness. FairCo
achieves group fairness by dynamically adding perturbations to
the ranking scores of documents based on the exposure of different
groups. It has been proven to be effective in optimizing the fairness
of dynamic LTR and much more efficient than LinProg.
For all models in the experiments on the News dataset, we use
ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘) to estimate document relevance directly as all users are
simulated. This means ğ‘ˆ ğ‘ ğ‘’_ğ¿ğ‘‡ ğ‘…_ğ‘šğ‘œğ‘‘ğ‘’ğ‘™ in Algo.1 is set as False.
LinProg and FairCo use a hyper-parameter to reduce unfairness
of exposure over all documents. For simplicity, we set it as 0.1
for LinProg and 0.01 for FairCo as these were the tuned hyperparameters in Morik et al. [20]. For MMF, we tune ğœ† from 0 to 1 and
show the corresponding results in Table 2a and Figure 4. Besides,
We follow the experiment setting in [20] and adopt the discount
function of NDCG as the userâ€™s user examination probability for
each position for this paper in simulation,

1
ğ‘ğ‘– =
(17)
ğ‘™ğ‘œğ‘”2(1 + ğ‘–)
where ğ‘ğ‘– indicates examination probability at rank ğ‘–.
3 https://www.adfontesmedia.com/interactive-media-bias-chart/

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

Tao Yang and Qingyao Ai

1.0
0.7
NDCG@k

0.0110

0.20

0.0105

0.15

0.0100

0.10

Naive
D_ULTR(Glob)
FairCo
LinProg
MMF( = 0.6)

0.05
0.00

0

1000

0.0095

2000

5800

4000

5000

6000

0.50
1.0
NDCG@10

0.48

Unfairness@10

3

5

0.0
0.0
0.0 3

0.2 5

10

20

all

10 0.6
Top_k

20
0.8

all 1.0

0.2
0.2
0.1
0.4

Figure 3: Performance of NDCG(top) and Unfairness (bottom) for different prefixes on News (20 trials).

0.46
0.8
0.44

0

1000

Naive
D_ULTR(Glob)
FairCo

LinProg
MMF( = 0.6)

2000

4000

3000

5000

6000

0.4
0.3
0.2
0.2
0.1
0.0
0.0 0

1000
0.2

20000.4 3000 0.64000
users

5000
0.8

60001.0

Figure 2: Convergence of NDCG@10 and Unfairness@10 as
the number of users increases on News. (20 trials)

5.2

LinProg
MMF( = 0.6)

0.5

6000

Figure 1: The absolute difference between estimated global
relevance and true global relevance on News (20 trials).

0.42
0.6
0.40

0.6
0.8

0.3
0.4
3000
users

Naive
D_ULTR(Glob)
FairCo

0.6
5600

Unfairness@k

Average |R IPS(d) R(d)|

0.25

Results with Simulated Preference Data

5.2.1 Do the unbiased estimates converge to the true relevance
no matter fairness controlling is applied or not? Fig. 1 shows the
absolute difference between estimated global relevance and true
global relevance defined in Eq. (5) after applying different ranking algorithm. The error of all algorithm with IPS weighting (Linprog,FairCo,D_ULTR(Glob) and MMF(ğœ† = 0.6)) gradually approach
zero, while the error of Naive algorithm keeps around 0.25. There
are no significant difference of convergence between IPS weighted
algorithms which means we could exclude the influence of relevance estimation when comparing ranking and fairness controlling
for IPS weighted algorithms. The result verifies that IPS weighting
help to get an unbiased estimation of the true expected relevance
for each news articles no matter what ranking algorithm is used
and thus estimated relevance can be used to maximize ranking and
fairness utility.
5.2.2 Can ğ‘€ğ‘€ğ¹ effectively reduce unfairness while maintaining
good ranking performance? Fig.2 shows the convergence NDCG@10
and unfairness@10 for Naive, D-ULTR(Glob), FairCo, Linprog and
MMF (ğœ† = 0.6). Among them, Naive shows the highest unfairness, while NDCG remains low as user interaction increases. DULTR(Glob) achieve the best NDCG while its unfairness is worse
than all other algorithms except Naive. Our algorithm MMF manages to substantially reduce unfairness while achieve similar NDCG

performance with D_ULTR(Glob). For the other two algorithm, LinProg and FairCo both show inferior performance than MMF in
terms of NDCG and unfairness.
5.2.3 How ğ‘€ğ‘€ğ¹ performs at different prefixes of a ranking? Fig.3
shows the performance NDCG and unfairness at different prefixes
for Naive, D-ULTR(Glob), FairCo,Linprog and MMF(ğœ† = 0.6 after
6000 users interactions. More details are shown in Table 2a. In terms
of NDCG performance, Naive shows worse performance than IPS
weighting algorithms, especially in top ranks, which make sense
since richer-get-richer dynamics can be more severe in top ranks.
In terms of fairness, among all algorithms, Naive shows the worst
performance almost for top ranks. Among the fairness controlling
algorithms, Linprog and FairCo show superior performance on
overall fairness (i.e., unfairness@all). As is shown in Table.2a, compared to Linprog and FairCo, MMF performs much better on top
ranks while showing a slight compromise on overall unfairness.
This may attribute to that MMF try to mitigate unfairness for each
prefix, while Linprog and FairCo always consider all documents.
We think this is the key advantage of our algorithm compared with
Linprog and FairCo since top ranks are relatively important for
rankings, and many users would leave after viewing top results.
5.2.4 How does ğœ† control trade-off between ranking performance
and unfairness for ğ‘€ğ‘€ğ¹ ? Fig. 4 shows the performance NDCG@10
and unfairness@10 for MMF with different ğœ† after 6000 users interactions. Note that we only show LinProg and FairCo with the
tuned hyper-parameters as shown in [20]. Thus their performances
are constants. As we can see, the use of hyper-parameter ğœ† in MMF
enables us to explicitly control the trade-off between relevance
and fairness. When ğœ† = 0.0, MMF degenerates to D_ULTR(Glob),
thus it has similar unfairness with D_ULTR(Glob), greater than
Linprog and FairCo. With the increasing of ğœ†, unfairness gradually
decreases and become less than Linprog and FairCo on top results.
From the figure, we can see that choosing ğœ† from 0.4 to 0.7 for MMF
can achieve better performance than the baseline algorithms on
both relevance and fairness.

Maximizing Marginal Fairness for Dynamic Learning to Rank

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

Table 2: Comparison of MMF with different baselines on News and Movie. Significant improvements or degradations with
respect to the performance of FairCo are indicated with +/âˆ’ in the paired t-test with p-value ğ‘ â‰¤ 0.05. The best performance
of fair algorithms in each column is highlighted in boldface.
(a) Performance of learning-to-rank algorithms on News data.

Unfair
Algorithms

NDCG@3

NDCG@5

NDCG@10

NDCG@all

Unfairness@3

Unf.@5

Unf.@10

Unf.@all

Naive
D_ULTR(Glob)

0.418âˆ’
0.438+

0.430âˆ’
0.448+

0.470âˆ’
0.490+

0.697âˆ’
0.708

0.220âˆ’
0.188âˆ’

0.268âˆ’
0.218âˆ’

0.293âˆ’
0.242âˆ’

0.174âˆ’
0.136âˆ’

FairCo
LinProg
MMF(ğœ† = 0.6)

0.434
0.433
0.436

0.443
0.439
0.447+

0.483
0.462
0.488+

0.705
0.694
0.708

0.036
0.043
0.004+

0.037
0.051
0.005+

0.049
0.065
0.007+

0.015
0.010
0.020

Fair Algorithms

(b) Performance of learning-to-rank algorithms on Movie data.
NDCG@3

NDCG@5

NDCG@10

NDCG@all

Unfairness@3

Unf.@5

Unf.@10

Unf.@all

Unfair
algorithm

Naive
D_ULTR(Glob)
D_ULTR

0.633âˆ’
0.671âˆ’
0.827+

0.638âˆ’
0.665âˆ’
0.819+

0.652âˆ’
0.672âˆ’
0.816+

0.761âˆ’
0.775âˆ’
0.871+

0.166âˆ’
0.102+
0.035+

0.168
0.105+
0.036+

0.111+
0.066+
0.042+

0.265âˆ’
0.243âˆ’
0.232âˆ’

Fair algorithm

FairCo
MMF(ğœ† = 0.1)

0.814
0.810

0.802
0.804

0.791
0.802+

0.850
0.863+

0.123
0.008+

0.162
0.011+

0.234
0.016+

0.021
0.312âˆ’

NDCG@10

1.0
0.49
0.48
0.8

Naive
D_ULTR(Glob)
FairCo

0.47

LinProg
MMF

0.6
0.0

0.2

0.4

0.6

0.8

1.0

0.0
0.00.0

0.20.2

0.4
0.4

0.6
0.6

0.80.8

1.01.0

Unfairness@10

0.3
0.4
0.2
0.2
0.1

Figure 4: Performance of NDCG@10(top) and Unfairness@10
(bottom) of MMF with different ğœ† on News (20 trials).

5.3

Real-World Preference Data

To evaluate our method on a real-world preference data, we use
the ML20M dataset, which we refer to as the Movie dataset. Following the prepossessing method in [20], we select five production
companies with the most movies in the dataset(MGM, Warner Bros,
Paramount, 20th Century Fox, Columbia). We aim to ensure fairness
of exposure for films from the five production companies, which
means movies from the same company belong to the same group.
A set of 300 most rated movies by those production companies are
selected. Then the 100 movies with the highest standard deviation
in the rating across users are selected. For users, we select 104 users
who have rated the most number of the chosen 100 movies. Finally,
we get a partially filled rating matrix with 104 users and 100 movies.
We use an off-the-shelf matrix factorization algorithm4 to fill the
missing entries. We then normalize the rating to [0, 1] by applying
a Sigmoid function centered at rating ğ‘ = 3 with slope ğ‘ = 10.
Thus, it can serve relevance probabilities where higher star ratings
4 Surprise library (http://surpriselib.com/) for SVD with biased=False and D=50

correspond to higher likelihoods of positive feedback, which is
used to generate clicks. We use the user embedding from the matrix
factorization model as user features ğ‘¥ğ‘¡ . We keep the dimension of
user features to 50. At each time step ğ‘¡, we sample a user ğ‘¥ğ‘¡ and the
ranking algorithm presents a ranking of the 100 movies. For the
user personal relevance estimation model ğ‘…ğœƒ used by FairCo and
DULTR, and our method, we use a one hidden-layer neural network
that consists of ğ· = 50 input nodes, which corresponds to user
feature dimension, then fully connected to 64 nodes in the hidden
layer with RELU activation, which is then connected 100 output
nodes with Sigmoid to output the predicted relevance probability
for the 100 selected movies.
Besides the baselines discussed in Section 5.1, we also include
a new baseline in the experiments on the Movie dataset, which
is D-ULTR. D-ULTR conducts unbiased learning to train the LTR
model with click data. Different from D-ULTR(Glob) that directly
ranks documents with ğ‘… ğ¼ ğ‘ƒğ‘† (ğ‘‘), D-ULTR can model personalized
relevance by taking user features into account when building the
LTR model. Thus, we expect D-ULTR to perform much better than
D-ULTR(Glob) on the Movie dataset with real user preferences.
Similarly, we train LTR models with user features for both FairCo
and MMF. Note that we exclude LinProg on the Movie dataset as it is
designed to work with global relevance and is too computationally
expensive for rankings with a large number of documents.

5.4

Results with Real-World Preference Data

5.4.1 Can ğ‘€ğ‘€ğ¹ effectively reduce unfairness while maintaining
good ranking performance? We show the performance of ranking relevance and fairness for all algorithms on the Movie dataset
in Fig. 5 For references, we plot a Skyline model that trains the
LTR model with ground truth relevance judgements and ranks documents via the output estimated relevance from the LTR model.
Firstly, as is shown in Fig. 5, personalization do help to reach better ranking performance just as [20] already reported. Ranking
algorithms (DULTR, FairCo, MMF, skyline) relying on personalized
relevance show superior ranking performance than algorithms like

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

Tao Yang and Qingyao Ai

1.0
0.80

1.0
0.85

0.65
0.6
0.60

Unfairness@10

NDCG@10

Naive
D-ULTR(Glob)
D-ULTR

0.75
0.8
0.70

FairCo
MMF( = 0.1)
Skyline

0

1000

2000

3000

4000

5000

0.15
0.2
0.10
0.05
0.00
0.0
0.0 0

1000
0.2

20000.4 3000 0.64000
users

5000
0.8

NDCG@k

1.0
0.8
0.8
0.7

Naive
D-ULTR(Global)
D-ULTR
3

5

10

FairCo
MMF( = 0.1)
20

30

50

all

0.5
0.4
0.4
0.3
0.2
0.2
0.1
0.0
0.0
0.0 3

50.2

10 0.4

20 0.6 30
Top_k

500.8

all 1.0

Figure 6: Performance of NDCG(top) and Unfairness (bottom) of MMF with different prefixes on Movie (5 trials).

Naive and DULTR(Glob), where no personalization is used. Ranking algorithms involving IPS and personalization can approach the
skyline as more user interactions are available, which again verifies
the effectiveness of IPS and personalization.
After we show the effectiveness of personalization and IPS, we
now take a look at the overall performance shwon in Table 2b.
Naive and DULTR(Glob) show the worst performance in terms
of ranking and fairness since no personalization or fairness controlling involved. Compared to FairCo, our method MMF(ğœ† = 0.1)
show a slight compromise on NDCG@3 while achieving better
performance on NDCG@5, NDCG@10, NDCG@all, and much better performance on fairness metrics on top results. The fairness
controlling of FairCo is not effective in optimizing fairness on top-k
ranks. We think the reason might be that FairCo focuses on mitigating overall unfairness instead of top ranks, which means it ignores
fairness of top ranks. Such phenomenon can be clearly shown in
Fig. 6.

0.0

0.2

0.4

0.6

Naive
D-ULTR(Global)
D-ULTR

0.4
0.20
0.15

0.8

1.0

FairCo
MMF

0.2
0.10
0.05
0.00
0.0
0.00.0

60001.0

Figure 5: Convergence of NDCG@10 and Unfairness@10 as
the number of users increases on Movie (5 trials).

Unfairness@k

0.70

6000

0.25
0.4
0.20

0.6
0.6

0.75
0.8
0.6
0.65

Unfairness@10

NDCG@10

0.80

0.20.2

0.4
0.4

0.6
0.6

0.80.8

1.01.0

Figure 7: Performance of NDCG@10(top) and Unfairness@10
(bottom) of MMF with different ğœ† on Movie (5 trials).
5.4.2 How does ğ‘€ğ‘€ğ¹ perform at different prefix of a ranking?
Fig.6 shows the performance NDCG and unfairness at different
prefixes for Naive, D-ULTR(Glob),ULTR, FairCo,MMF (ğœ† = 0.1)
after 6000 users interactions. As we can see, MMF achieves similar
performance with D-ULTR in terms of relevance ranking while
maintaining superior performance on ranking fairness on top results. Specifically, it significantly outperforms FairCo on both relevance and fairness for ğ‘˜ from 3 to 50. While FairCo has excellent
performance on unfairness@all, it sacrifices both relevance and fairness performance on top results significantly. It even shows more
unfairness on top results than unfair algorithms such as D-ULTR.
5.4.3 How does ğœ† control trade-off of ranking performance and mitigating unfairness for ğ‘€ğ‘€ğ¹ . Fig. 7 shows the performance NDCG@10
and unfairness@10 for MMF with different ğœ† after 6000 users interactions. Again, we report FairCo with the best parameter settings
here. As ğœ† gradually increases, a trade-off can be seen from the
growing of fairness (negative unfairness) and decreasing of ranking
performance. And we may choose ğœ† to be between 0.0 and 0.2, between which MMF have better ranking performance as well as less
unfairness. The optimal ğœ† for Movie data is smaller than for News
data. We think itâ€™s because of their different relevance distribution.
Documents in the News dataset often have similar relevance. In
such situation, we should pay more attention to fairness (greater ğœ†)
for News dataset since relevance of different documents are close
to each other.

6

CONCLUSION AND FUTURE WORK

In this work, we propose a concept of marginal fairness and a Maximal Marginal Fairness (MMF) algorithm for balancing the relevance
and fairness of top-k results in dynamic learning to rank. We develop a metric to measure the group fairness of exposure in the
top-k results of each ranked list and show that most existing stateof-the-art methods for ranking fairness focus more on the overall
fairness of document exposure while compromising a lot in top
ranks of each ranked list. In contrast, our proposed MMF algorithm
explicitly maximizes the marginal fairness of top-k rankings and
can produce better rankings than the state-of-the-art fairness algorithms in both top-k relevance and top-k fairness. In the future,

Maximizing Marginal Fairness for Dynamic Learning to Rank

we will further explore the possibility of extending MMF for more
general ranking scenarios or construct new LTR models that integrate the optimization of relevance and fairness from the bottom
of model design.

ACKNOWLEDGMENTS
This work was supported in part by the School of Computing,
University of Utah. Any opinions, findings and conclusions or recommendations expressed in this material are those of the authors
and do not necessarily reflect those of the sponsor.

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

REFERENCES
[1] Aman Agarwal, Kenta Takatsu, Ivan Zaitsev, and Thorsten Joachims. 2019. A
general framework for counterfactual learning-to-rank. In Proceedings of the 42nd
International ACM SIGIR Conference on Research and Development in Information
Retrieval. 5â€“14.
[2] Aman Agarwal, Ivan Zaitsev, Xuanhui Wang, Cheng Li, Marc Najork, and
Thorsten Joachims. 2019. Estimating position bias without intrusive interventions. In Proceedings of the Twelfth ACM International Conference on Web Search
and Data Mining. 474â€“482.
[3] Qingyao Ai, Keping Bi, Cheng Luo, Jiafeng Guo, and W Bruce Croft. 2018. Unbiased learning to rank with unbiased propensity estimation. In The 41st International ACM SIGIR Conference on Research & Development in Information Retrieval.
385â€“394.
[4] Qingyao Ai, Tao Yang, Huazheng Wang, and Jiaxin Mao. 2020. Unbiased Learning
to Rank: Online or Offline? arXiv preprint arXiv:2004.13574 (2020).
[5] Asia J Biega, Krishna P Gummadi, and Gerhard Weikum. 2018. Equity of attention:
Amortizing individual fairness in rankings. In The 41st international acm sigir
conference on research & development in information retrieval. 405â€“414.
[6] Jaime Carbonell and Jade Goldstein. 1998. The use of MMR, diversity-based
reranking for reordering documents and producing summaries. In Proceedings of
the 21st annual international ACM SIGIR conference on Research and development
in information retrieval. 335â€“336.
[7] L Elisa Celis, Damian Straszak, and Nisheeth K Vishnoi. 2018. Ranking with Fairness Constraints. In 45th International Colloquium on Automata, Languages, and
Programming (ICALP 2018). Schloss Dagstuhl-Leibniz-Zentrum fuer Informatik.
[8] Nick Craswell, Onno Zoeter, Michael Taylor, and Bill Ramsey. 2008. An experimental comparison of click position-bias models. In Proceedings of the 1st WSDM.
ACM, 87â€“94.
[9] Georges E Dupret and Benjamin Piwowarski. 2008. A user browsing model to
predict search engine click data from past observations.. In Proceedings of the
31st annual international ACM SIGIR conference on Research and development in
information retrieval. 331â€“338.
[10] F Maxwell Harper and Joseph A Konstan. 2015. The movielens datasets: History
and context. Acm transactions on interactive intelligent systems (tiis) 5, 4 (2015),
1â€“19.
[11] Zhengbao Jiang, Ji-Rong Wen, Zhicheng Dou, Wayne Xin Zhao, Jian-Yun Nie,
and Ming Yue. 2017. Learning to diversify search results via subtopic attention.
In Proceedings of the 40th international ACM SIGIR Conference on Research and
Development in Information Retrieval. 545â€“554.
[12] Jiarui Jin, Yuchen Fang, Weinan Zhang, Kan Ren, Guorui Zhou, Jian Xu, Yong Yu,
Jun Wang, Xiaoqiang Zhu, and Kun Gai. 2020. A Deep Recurrent Survival Model
for Unbiased Ranking. arXiv preprint arXiv:2004.14714 (2020).
[13] Thorsten Joachims. 2002. Optimizing search engines using clickthrough data. In
Proceedings of the 8th ACM SIGKDD. ACM, 133â€“142.
[14] Thorsten Joachims, Laura Granka, Bing Pan, Helene Hembrooke, and Geri Gay.
2005. Accurately interpreting clickthrough data as implicit feedback. In Proceedings of the 28th annual ACM SIGIR. Acm, 154â€“161.
[15] Thorsten Joachims, Laura Granka, Bing Pan, Helene Hembrooke, and Geri Gay.
2017. Accurately interpreting clickthrough data as implicit feedback. In ACM
SIGIR Forum, Vol. 51. Acm New York, NY, USA, 4â€“11.
[16] Thorsten Joachims, Laura Granka, Bing Pan, Helene Hembrooke, Filip Radlinski,
and Geri Gay. 2007. Evaluating the accuracy of implicit feedback from clicks and
query reformulations in web search. ACM Transactions on Information Systems
25, 2 (2007), 7.
[17] Thorsten Joachims, Adith Swaminathan, and Tobias Schnabel. 2017. Unbiased
learning-to-rank with biased feedback. In Proceedings of the Tenth ACM International Conference on Web Search and Data Mining. 781â€“789.
[18] Tie-Yan Liu. 2011. Learning to rank for information retrieval. Springer Science &
Business Media.
[19] Stepan Malkevich, Ilya Markov, Elena Michailova, and Maarten de Rijke. 2017.
Evaluating and Analyzing Click Simulation in Web Search. In Proceedings of the
ACM ICTIR (Amsterdam, The Netherlands) (ICTIR â€™17). ACM, 281â€“284.
[20] Marco Morik, Ashudeep Singh, Jessica Hong, and Thorsten Joachims. 2020. Controlling Fairness and Bias in Dynamic Learning-to-Rank. In Proceedings of the 43rd
International ACM SIGIR Conference on Research and Development in Information
Retrieval (Virtual Event, China) (SIGIR â€™20). Association for Computing Machinery, New York, NY, USA, 429â€“438. https://doi.org/10.1145/3397271.3401100
[21] Zohreh Ovaisi, Ragib Ahsan, Yifan Zhang, Kathryn Vasilaky, and Elena Zheleva.
2020. Correcting for Selection Bias in Learning-to-rank Systems. In Proceedings
of The Web Conference 2020. 1863â€“1873.
[22] Filip Radlinski and Thorsten Joachims. 2006. Minimally invasive randomization
for collecting unbiased preferences from clickthrough logs. In Proceedings of the
national conference on artificial intelligence, Vol. 21. Menlo Park, CA; Cambridge,
MA; London; AAAI Press; MIT Press; 1999, 1406.
[23] Stephen E Robertson. 1977. The probability ranking principle in IR. Journal of
documentation (1977).

WWW â€™21, April 19â€“23, 2021, Ljubljana, Slovenia

[24] LT Rodrygo, Craig Macdonald, and Iadh Ounis. 2015. Search result diversification.
Foundations and Trends in Information Retrieval 9, 1 (2015), 1â€“90.
[25] Ashudeep Singh and Thorsten Joachims. 2018. Fairness of exposure in rankings.
In Proceedings of the 24th ACM SIGKDD International Conference on Knowledge
Discovery & Data Mining. 2219â€“2228.
[26] Ashudeep Singh and Thorsten Joachims. 2019. Policy learning for fairness in
ranking. In Advances in Neural Information Processing Systems. 5426â€“5436.
[27] Chao Wang, Yiqun Liu, Min Zhang, Shaoping Ma, Meihong Zheng, Jing Qian,
and Kuo Zhang. 2013. Incorporating vertical results into search click models. In
Proceedings of the 36th ACM SIGIR. ACM, 503â€“512.
[28] Xuanhui Wang, Michael Bendersky, Donald Metzler, and Marc Najork. 2016.
Learning to rank with selection bias in personal search. In Proceedings of the 39th
International ACM SIGIR conference on Research and Development in Information
Retrieval. 115â€“124.
[29] Xuanhui Wang, Nadav Golbandi, Michael Bendersky, Donald Metzler, and Marc
Najork. 2018. Position bias estimation for unbiased learning to rank in personal
search. In Proceedings of the Eleventh ACM International Conference on Web Search
and Data Mining. 610â€“618.
[30] Long Xia, Jun Xu, Yanyan Lan, Jiafeng Guo, and Xueqi Cheng. 2015. Learning
maximal marginal relevance model via directly optimizing diversity evaluation

Tao Yang and Qingyao Ai

measures. In Proceedings of the 38th international ACM SIGIR conference on research
and development in information retrieval. 113â€“122.
[31] Long Xia, Jun Xu, Yanyan Lan, Jiafeng Guo, Wei Zeng, and Xueqi Cheng. 2017.
Adapting Markov decision process for search result diversification. In Proceedings
of the 40th International ACM SIGIR Conference on Research and Development in
Information Retrieval. 535â€“544.
[32] Ke Yang and Julia Stoyanovich. 2017. Measuring fairness in ranked outputs.
In Proceedings of the 29th International Conference on Scientific and Statistical
Database Management. 1â€“6.
[33] Yisong Yue, Rajan Patel, and Hein Roehrig. 2010. Beyond position bias: Examining
result attractiveness as a source of presentation bias in clickthrough data. In
Proceedings of the 19th WWW. ACM, 1011â€“1018.
[34] Meike Zehlike, Francesco Bonchi, Carlos Castillo, Sara Hajian, Mohamed Megahed, and Ricardo Baeza-Yates. 2017. Fa* ir: A fair top-k ranking algorithm. In
Proceedings of the 2017 ACM on Conference on Information and Knowledge Management. 1569â€“1578.
[35] Meike Zehlike and Carlos Castillo. 2020. Reducing disparate exposure in ranking:
A learning to rank approach. In Proceedings of The Web Conference 2020. 2849â€“
2855.

